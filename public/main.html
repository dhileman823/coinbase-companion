<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Coinbase Companion</title>

    <script src="/__/firebase/8.8.1/firebase-app.js"></script>
    <script src="/__/firebase/8.8.1/firebase-auth.js"></script>
    <script src="/__/firebase/8.8.1/firebase-firestore.js"></script>
    <script src="/__/firebase/8.8.1/firebase-functions.js"></script>
    <script src="/__/firebase/init.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script defer src="js/user-manager.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/main.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">

    <script src="https://www.gstatic.com/firebasejs/ui/4.5.0/firebase-ui-auth.js"></script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.5.0/firebase-ui-auth.css"/>

    <link type="text/css" rel="stylesheet" href="css/settings.css"/>

    <style>
      .mdl-shadow--2dp {
        box-shadow: none;
      }
    </style>

  </head>
  <body>

    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">Coinbase Companion</span>
            <span class="navbar-text" id="btnLogout" onclick="logout()" style="cursor:pointer;display:none">Logout</span>
        </div>
    </nav>

    <ul class="nav nav-tabs justify-content-center" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="false"><i class="bi-graph-up"></i> Markets</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="home" aria-selected="true"><i class="bi-arrow-repeat"></i> Order</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#panelSettings" type="button" role="tab" aria-controls="contact" aria-selected="false"><i class="bi-gear"></i> Settings</button>
        </li>
    </ul>
    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="profile" role="tabpanel" aria-labelledby="profile-tab">
            <h6 style="margin-top:10px;margin-left:5px;">Cryptocurrency</h6>
            <div style="height:540px;margin-top:10px"><!-- TradingView wrapper div BEGIN -->
                <!-- TradingView Widget BEGIN -->
                <div class="tradingview-widget-container">
                  <div class="tradingview-widget-container__widget"></div>
                  <div class="tradingview-widget-copyright"><a href="https://www.tradingview.com" rel="noopener" target="_blank"><span class="blue-text">Digital Currency</span></a> by TradingView</div>
                  <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>
                  {
                  "colorTheme": "light",
                  "dateRange": "12M",
                  "showChart": true,
                  "locale": "en",
                  "width": "100%",
                  "height": "100%",
                  "largeChartUrl": "",
                  "isTransparent": false,
                  "showSymbolLogo": true,
                  "showFloatingTooltip": false,
                  "plotLineColorGrowing": "rgba(41, 98, 255, 1)",
                  "plotLineColorFalling": "rgba(41, 98, 255, 1)",
                  "gridLineColor": "rgba(42, 46, 57, 0)",
                  "scaleFontColor": "rgba(120, 123, 134, 1)",
                  "belowLineFillColorGrowing": "rgba(41, 98, 255, 0.12)",
                  "belowLineFillColorFalling": "rgba(41, 98, 255, 0.12)",
                  "belowLineFillColorGrowingBottom": "rgba(41, 98, 255, 0)",
                  "belowLineFillColorFallingBottom": "rgba(41, 98, 255, 0)",
                  "symbolActiveColor": "rgba(41, 98, 255, 0.12)",
                  "tabs": [
                    {
                      "title": "Digital Currency",
                      "symbols": [
                        {
                          "s": "COINBASE:BTCUSD",
                          "d": "Bitcoin"
                        },
                        {
                          "s": "COINBASE:ETHUSD",
                          "d": "Ethereum"
                        },
                        {
                          "s": "COINBASE:ADAUSD",
                          "d": "Cardano"
                        },
                        {
                          "s": "COINBASE:SOLUSD",
                          "d": "Solana"
                        },
                        {
                          "s": "COINBASE:DOTUSD",
                          "d": "Polkadot"
                        }
                      ]
                    }
                  ]
                }
                  </script>
                </div>
                <!-- TradingView Widget END -->
            </div><!-- TradingView wrapper div END -->
        </div>
        <div class="tab-pane fade" id="home" role="tabpanel" aria-labelledby="home-tab">
            Order panel
        </div>
        <div class="tab-pane fade" id="panelSettings" role="tabpanel" aria-labelledby="contact-tab">
        </div>
    </div>

    <div class="modal fade" id="signInModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <section id="firebaseui-auth-container"></section>
            </div>
          </div>
      </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
          // // ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥
          // // The Firebase SDK is initialized and available here!
          firebase.auth().onAuthStateChanged(user => { 
              console.log("Auth: user " + user);
              if(user && user.email){
                document.getElementById("btnLogout").style.display = "inline";
                onPageLoad(user);
              }
              else{
                document.getElementById("btnLogout").style.display = "none";
                onPageLoad(null);
              }
          });
          // firebase.database().ref('/path/to/ref').on('value', snapshot => { });
          // firebase.firestore().doc('/foo/bar').get().then(() => { });
          // firebase.functions().httpsCallable('yourFunction')().then(() => { });
          // firebase.messaging().requestPermission().then(() => { });
          // firebase.storage().ref('/path/to/ref').getDownloadURL().then(() => { });
          // firebase.analytics(); // call to activate
          // firebase.analytics().logEvent('tutorial_completed');
          // firebase.performance(); // call to activate
          //
          // // ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥
  
          try {
            let app = firebase.app();
            let features = [
              'auth', 
              'database', 
              'firestore',
              'functions',
              'messaging', 
              'storage', 
              'analytics', 
              'remoteConfig',
              'performance',
            ].filter(feature => typeof app[feature] === 'function');
          } catch (e) {
            console.error(e);
          }

          const firebaseUI = new firebaseui.auth.AuthUI(firebase.auth());
          const firebaseUiConfig = {
            callbacks: {
              signInSuccessWithAuthResult: function (authResult, redirectUrl) {
                // User successfully signed in.
                // Return type determines whether we continue the redirect automatically
                // or whether we leave that to developer to handle.
                return true;
              },
              uiShown: () => {
                //document.getElementById('loader').style.display = 'none';
              },
            },
            signInFlow: 'popup',
            signInSuccessUrl: 'main.html',
            signInOptions: [
              firebase.auth.EmailAuthProvider.PROVIDER_ID,
            ],
            credentialHelper: firebaseui.auth.CredentialHelper.NONE,
            // Your terms of service url.
            tosUrl: 'https://example.com/terms',
            // Your privacy policy url.
            privacyPolicyUrl: 'https://example.com/privacy',
          };
          firebaseUI.start('#firebaseui-auth-container', firebaseUiConfig);
        });
      </script>
  </body>
</html>